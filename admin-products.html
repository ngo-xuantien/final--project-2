<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Admin Products - Tr√† S·ªØa MoMo</title>
  <link rel="stylesheet" href="style.css"/>
</head>
<body>

<header class="header">
  <div class="nav-inner">
    <div class="logo-wrap">
      <div class="logo-dot"></div>
      <span>Tr√† S·ªØa MoMo</span>
    </div>
    <nav class="nav-links">
      <a href="index.html">Home</a>
      <a href="menu.html">Menu</a>
      <a href="about.html">About</a>
      <a href="contact.html">Contact</a>
      <a href="login.html">Login</a>
      <a href="admin-products.html" class="badge">Admin</a>
      <button id="open-cart" class="cart-btn">
        üõí <span id="cart-count">0</span>
      </button>
    </nav>
  </div>
</header>

<main class="container">
  <div class="section-header">
    <div>
      <h2>Admin s·∫£n ph·∫©m</h2>
      <p>Qu·∫£n l√Ω menu MoMo (JSON Server)</p>
    </div>
  </div>
  <section class="card">
    <h3 class="card-title">Th√™m / s·ª≠a s·∫£n ph·∫©m</h3>
    <form id="product-form">
      <input type="hidden" id="product-id"/>
      <div style="display:flex;gap:10px;flex-wrap:wrap;">
        <input id="product-name" required placeholder="T√™n s·∫£n ph·∫©m" style="flex:2;padding:8px;border-radius:8px;border:1px solid #eee;"/>
        <input id="product-price" required type="number" placeholder="Gi√°" style="flex:1;padding:8px;border-radius:8px;border:1px solid #eee;"/>
      </div>
      <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:8px;">
        <input id="product-img" placeholder="ƒê∆∞·ªùng d·∫´n ·∫£nh (SVG/JPG)" style="flex:2;padding:8px;border-radius:8px;border:1px solid #eee;"/>
        <select id="product-cat" style="flex:1;padding:8px;border-radius:8px;border:1px solid #eee;">
          <option value="milk">Tr√† s·ªØa</option>
          <option value="fruit">Tr√† tr√°i c√¢y</option>
          <option value="signature">Signature</option>
          <option value="topping">Topping</option>
        </select>
      </div>
      <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:8px;">
        <textarea id="product-desc" placeholder="M√¥ t·∫£ (optional)" style="flex:2;padding:8px;border-radius:8px;border:1px solid #eee;min-height:60px;"></textarea>
        <select id="product-tag" style="flex:1;padding:8px;border-radius:8px;border:1px solid #eee;">
          <option value="">Kh√¥ng tag</option>
          <option value="Best seller">Best seller</option>
          <option value="Signature">Signature</option>
          <option value="Hot">Hot</option>
          <option value="New">New</option>
        </select>
      </div>
      <div style="margin-top:10px;display:flex;gap:8px;">
        <button class="btn-primary" type="submit">L∆∞u</button>
        <button class="btn-text" type="button" onclick="resetProductForm()">Reset</button>
      </div>
      <p class="card-sub" id="admin-msg" style="margin-top:8px;"></p>
    </form>
  </section>

  <section class="card" style="margin-top:16px;">
    <h3 class="card-title">Danh s√°ch s·∫£n ph·∫©m</h3>
    <table class="table">
      <thead>
        <tr>
          <th>ID</th><th>T√™n</th><th>Gi√°</th><th>Lo·∫°i</th><th>Tag</th><th>·∫¢nh</th><th>Action</th>
        </tr>
      </thead>
      <tbody id="product-table-body"></tbody>
    </table>
  </section>
</main>

<footer class="footer">
  <div class="footer-inner">
    <div>
      <strong>Tr√† S·ªØa MoMo</strong><br/>
      65 Nguy·ªÖn Bi·ªÉu, P1, Q5, TP.HCM<br/>
      Hotline: 090-xxx-xxxx
    </div>
    <div style="text-align:right;">
      Follow: Facebook ¬∑ TikTok<br/>
      Gi·ªù m·ªü c·ª≠a: 8:00 - 22:00
    </div>
  </div>
</footer>


<!-- Commit: N√∫t m·ªü/ƒë√≥ng c·ª≠a s·ªï chat MoMo Bot -->
<button id="chatbot-btn">üí¨</button>

<!-- Commit: C·ª≠a s·ªï chat MoMo Bot -->
<div id="chat-window">
  <div id="chat-header">
    <div class="chat-header-left">
      <div class="bot-avatar">üßã</div>
      <div>
        <div class="bot-name">MoMo Bot</div>
        <div class="bot-sub">b√© MoMo online n√® ü§ó</div>
      </div>
    </div>
    <button id="voice-toggle" title="B·∫≠t/T·∫Øt gi·ªçng n√≥i">üîà</button>
  </div>

  <div id="chat-body">
    <div class="bot-msg msg-with-avatar">
      <div class="bot-avatar-small">üßã</div>
      <div class="msg-bubble">D·∫° b√© MoMo ch√†ooo ~ B·∫°n mu·ªën h·ªèi g√¨ hong n√®? üíó</div>
    </div>

    <div id="faq-suggestions"></div>

    <div id="typing-indicator" class="typing" style="display:none;">
      MoMo ƒëang g√µ tr·∫£ l·ªùi cho b·∫°n ...
      <span class="dot"></span><span class="dot"></span><span class="dot"></span>
    </div>
  </div>

  <div id="chat-input-box">
    <input id="chat-input" placeholder="Nh·∫Øn g√¨ ƒë√≥ v·ªõi b√© MoMo n√®..." />
    <button id="chat-send">G·ª≠i</button>
  </div>
</div>

<link rel="stylesheet" href="chatbot.css">
<script src="chatbot.js"></script>

<script src="script.js"></script>
<script>
const adminMsg = document.getElementById('admin-msg');
const productTBody = document.getElementById('product-table-body');
const productForm = document.getElementById('product-form');

function setAdminMsg(text) {
  adminMsg.textContent = text || '';
}

function resetProductForm() {
  productForm.reset();
  document.getElementById('product-id').value = '';
}

function loadProducts() {
  fetch(API_URL + '/products')
    .then(res => res.json())
    .then(data => {
      productTBody.innerHTML = '';
      data.forEach(p => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${p.id}</td>
          <td>${p.name}</td>
          <td>${p.price.toLocaleString()}ƒë</td>
          <td>${p.category}</td>
          <td>${p.tag || ''}</td>
          <td><span class="card-sub">${p.img}</span></td>
          <td>
            <button class="btn-text" onclick="editProduct(${p.id})">S·ª≠a</button>
            |
            <button class="btn-text" onclick="deleteProduct(${p.id})">X√≥a</button>
          </td>
        `;
        productTBody.appendChild(tr);
      });
    })
    .catch(err => {
      console.error(err);
      setAdminMsg('Kh√¥ng t·∫£i ƒë∆∞·ª£c s·∫£n ph·∫©m. Nh·ªõ ch·∫°y JSON Server nha b√©.');
    });
}

function editProduct(id) {
  fetch(API_URL + '/products/' + id)
    .then(res => res.json())
    .then(p => {
      document.getElementById('product-id').value = p.id;
      document.getElementById('product-name').value = p.name;
      document.getElementById('product-price').value = p.price;
      document.getElementById('product-img').value = p.img;
      document.getElementById('product-cat').value = p.category;
      document.getElementById('product-desc').value = p.description || '';
      document.getElementById('product-tag').value = p.tag || '';
    });
}

function deleteProduct(id) {
  if (!confirm('X√≥a s·∫£n ph·∫©m #' + id + ' h·∫£ b√©?')) return;
  fetch(API_URL + '/products/' + id, { method:'DELETE' })
    .then(() => {
      setAdminMsg('ƒê√£ x√≥a s·∫£n ph·∫©m #' + id);
      loadProducts();
    })
    .catch(err => {
      console.error(err);
      setAdminMsg('Kh√¥ng x√≥a ƒë∆∞·ª£c s·∫£n ph·∫©m. Ki·ªÉm tra JSON Server nha.');
    });
}

productForm.addEventListener('submit', (e) => {
  e.preventDefault();
  const id = document.getElementById('product-id').value;
  const body = {
    name: document.getElementById('product-name').value,
    price: Number(document.getElementById('product-price').value),
    img: document.getElementById('product-img').value || 'assets/img/momo_signature.svg',
    category: document.getElementById('product-cat').value,
    description: document.getElementById('product-desc').value,
    tag: document.getElementById('product-tag').value || undefined
  };
  const method = id ? 'PUT' : 'POST';
  const url = id ? (API_URL + '/products/' + id) : (API_URL + '/products');
  fetch(url, {
    method,
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify(body)
  })
    .then(res => res.json())
    .then(p => {
      setAdminMsg('ƒê√£ l∆∞u s·∫£n ph·∫©m #' + p.id + ' th√†nh c√¥ng.');
      resetProductForm();
      loadProducts();
    })
    .catch(err => {
      console.error(err);
      setAdminMsg('Kh√¥ng l∆∞u ƒë∆∞·ª£c s·∫£n ph·∫©m.');
    });
});

document.addEventListener('DOMContentLoaded', loadProducts);
</script>
</body>
</html>
