<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Admin Orders - TrÃ  Sá»¯a MoMo</title>
  <link rel="stylesheet" href="style.css"/>
</head>
<body>

<header class="header">
  <div class="nav-inner">
    <div class="logo-wrap">
      <div class="logo-dot"></div>
      <span>TrÃ  Sá»¯a MoMo</span>
    </div>
    <nav class="nav-links">
      <a href="index.html">Home</a>
      <a href="menu.html">Menu</a>
      <a href="about.html">About</a>
      <a href="contact.html">Contact</a>
      <a href="login.html">Login</a>
      <a href="admin-products.html" class="badge">Admin</a>
      <button id="open-cart" class="cart-btn">
        ğŸ›’ <span id="cart-count">0</span>
      </button>
    </nav>
  </div>
</header>

<main class="container">
  <div class="section-header">
    <div>
      <h2>Admin Ä‘Æ¡n hÃ ng</h2>
      <p>Theo dÃµi & cáº­p nháº­t tráº¡ng thÃ¡i Ä‘Æ¡n</p>
    </div>
  </div>
  <section class="card">
    <table class="table">
      <thead>
        <tr>
          <th>ID</th><th>Thá»i gian</th><th>Tá»•ng</th><th>Tráº¡ng thÃ¡i</th><th>Chi tiáº¿t</th><th>Action</th>
        </tr>
      </thead>
      <tbody id="order-body"></tbody>
    </table>
    <p class="card-sub" id="order-msg" style="margin-top:8px;"></p>
  </section>
</main>

<footer class="footer">
  <div class="footer-inner">
    <div>
      <strong>TrÃ  Sá»¯a MoMo</strong><br/>
      65 Nguyá»…n Biá»ƒu, P1, Q5, TP.HCM<br/>
      Hotline: 090-xxx-xxxx
    </div>
    <div style="text-align:right;">
      Follow: Facebook Â· TikTok<br/>
      Giá» má»Ÿ cá»­a: 8:00 - 22:00
    </div>
  </div>
</footer>


<!-- Commit: NÃºt má»Ÿ/Ä‘Ã³ng cá»­a sá»• chat MoMo Bot -->
<button id="chatbot-btn">ğŸ’¬</button>

<!-- Commit: Cá»­a sá»• chat MoMo Bot -->
<div id="chat-window">
  <div id="chat-header">
    <div class="chat-header-left">
      <div class="bot-avatar">ğŸ§‹</div>
      <div>
        <div class="bot-name">MoMo Bot</div>
        <div class="bot-sub">bÃ© MoMo online nÃ¨ ğŸ¤—</div>
      </div>
    </div>
    <button id="voice-toggle" title="Báº­t/Táº¯t giá»ng nÃ³i">ğŸ”ˆ</button>
  </div>

  <div id="chat-body">
    <div class="bot-msg msg-with-avatar">
      <div class="bot-avatar-small">ğŸ§‹</div>
      <div class="msg-bubble">Dáº¡ bÃ© MoMo chÃ ooo ~ Báº¡n muá»‘n há»i gÃ¬ hong nÃ¨? ğŸ’—</div>
    </div>

    <div id="faq-suggestions"></div>

    <div id="typing-indicator" class="typing" style="display:none;">
      MoMo Ä‘ang gÃµ tráº£ lá»i cho báº¡n ...
      <span class="dot"></span><span class="dot"></span><span class="dot"></span>
    </div>
  </div>

  <div id="chat-input-box">
    <input id="chat-input" placeholder="Nháº¯n gÃ¬ Ä‘Ã³ vá»›i bÃ© MoMo nÃ¨..." />
    <button id="chat-send">Gá»­i</button>
  </div>
</div>

<link rel="stylesheet" href="chatbot.css">
<script src="chatbot.js"></script>

<script src="script.js"></script>
<script>
const orderBody = document.getElementById('order-body');
const orderMsg = document.getElementById('order-msg');

function setOrderMsg(text) {
  orderMsg.textContent = text || '';
}

function renderStatus(status) {
  if (status === 'pending') return '<span class="badge">pending</span>';
  if (status === 'confirmed') return '<span class="badge" style="background:#4caf50;">confirmed</span>';
  if (status === 'done') return '<span class="badge" style="background:#2196f3;">done</span>';
  return status;
}

function loadOrders() {
  fetch(API_URL + '/orders')
    .then(res => res.json())
    .then(data => {
      orderBody.innerHTML = '';
      data.forEach(o => {
        const tr = document.createElement('tr');
        const dateStr = o.createdAt ? new Date(o.createdAt).toLocaleString('vi-VN') : '';
        const itemsStr = (o.items || []).map(i => i.name + ' x' + i.qty).join('<br/>');
        tr.innerHTML = `
          <td>${o.id}</td>
          <td>${dateStr}</td>
          <td>${(o.total || 0).toLocaleString()}Ä‘</td>
          <td>${renderStatus(o.status)}</td>
          <td class="card-sub">${itemsStr}</td>
          <td><button class="btn-text" onclick="nextStatus(${o.id}, '${o.status}')">Next tráº¡ng thÃ¡i</button></td>
        `;
        orderBody.appendChild(tr);
      });
    })
    .catch(err => {
      console.error(err);
      setOrderMsg('KhÃ´ng táº£i Ä‘Æ°á»£c Ä‘Æ¡n hÃ ng. Nhá»› cháº¡y JSON Server nha.');
    });
}

function nextStatus(id, current) {
  const flow = ['pending','confirmed','done'];
  const idx = flow.indexOf(current);
  const next = flow[(idx + 1) % flow.length];
  fetch(API_URL + '/orders/' + id, {
    method:'PATCH',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({ status: next })
  })
    .then(res => res.json())
    .then(o => {
      setOrderMsg('ÄÃ£ cáº­p nháº­t Ä‘Æ¡n #' + id + ' sang ' + o.status);
      loadOrders();
    })
    .catch(err => {
      console.error(err);
      setOrderMsg('KhÃ´ng cáº­p nháº­t Ä‘Æ°á»£c Ä‘Æ¡n.');
    });
}

document.addEventListener('DOMContentLoaded', loadOrders);
</script>
</body>
</html>
